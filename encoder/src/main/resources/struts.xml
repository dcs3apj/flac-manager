<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">
<struts>

	<include file="struts-default.xml" />

	<package name="default" extends="struts-default" namespace="/">
		
		<interceptors>
			<interceptor
				name="execAndWait"
				class="uk.co.unclealex.flacconverter.interceptor.HibernateSessionExecuteAndWaitInterceptor"/>			
			<interceptor
				name="prepareAfter"
				class="uk.co.unclealex.flacconverter.interceptor.PrepareAfterInterceptor"/>			

			<interceptor-stack name="scopedStack">
        <interceptor-ref name="exception"/>
        <interceptor-ref name="alias"/>
        <interceptor-ref name="servletConfig"/>
        <interceptor-ref name="prepare"/>
        <interceptor-ref name="prepareAfter"/>
        <interceptor-ref name="i18n"/>
		    <interceptor-ref name="scope">
		    	<param name="key">cart:</param>
	        <param name="session">sessionDownloadCartBean</param>
	        <param name="autoCreateSession">true</param>
		    </interceptor-ref>
        <interceptor-ref name="chain"/>
        <interceptor-ref name="staticParams"/>
        <interceptor-ref name="params">
          <param name="excludeParams">dojo\..*</param>
        </interceptor-ref>
        <interceptor-ref name="conversionError"/>
        <interceptor-ref name="workflow">
            <param name="excludeMethods">input,back,cancel,browse</param>
        </interceptor-ref>
		</interceptor-stack>
		</interceptors>
		
		<default-interceptor-ref name="scopedStack"/>

		<action name="index"
			class="uk.co.unclealex.flacconverter.actions.FlacAction">
			<result name="success" type="redirect">/html/index.html</result>
		</action>

	</package>
	
	<package name="html" extends="default" namespace="/html">
			
		<action name="index"
			class="uk.co.unclealex.flacconverter.actions.FlacAction">
			<result name="success">/WEB-INF/pages/index.jsp</result>
		</action>

		<action name="manage-devices"
			class="uk.co.unclealex.flacconverter.actions.ManageDevicesAction">
			<result name="success">/WEB-INF/pages/manage-devices.jsp</result>
		</action>

		<action name="device-download"
			class="uk.co.unclealex.flacconverter.actions.FlacAction">
			<result name="success">/WEB-INF/pages/device-downloading.jsp</result>
		</action>

		<action name="edit-owner"
			class="uk.co.unclealex.flacconverter.actions.EditOwnerAction">
			<result name="success">/WEB-INF/pages/owner.jsp</result>
		</action>

		<action name="artists"
			class="uk.co.unclealex.flacconverter.actions.ArtistsAction">
			<result name="success">/WEB-INF/pages/artists.jsp</result>
		</action>
		
		<action name="albums"
			class="uk.co.unclealex.flacconverter.actions.AlbumsAction">
			<result name="success">/WEB-INF/pages/albums.jsp</result>
		</action>

		<action name="tracks"
			class="uk.co.unclealex.flacconverter.actions.TracksAction">
			<result name="success">/WEB-INF/pages/tracks.jsp</result>
		</action>

		<action name="addartists"
			class="uk.co.unclealex.flacconverter.actions.AddArtistsToCartAction">
			<result name="success" type="chain">
				<param name="actionName">artists</param>
				<param name="namespace">/html</param>
				<param name="method">execute</param>
			</result>
		</action>

		<action name="addalbums"
			class="uk.co.unclealex.flacconverter.actions.AddAlbumsToCartAction">
			<result name="success" type="chain">
				<param name="actionName">albums</param>
				<param name="namespace">/html</param>
				<param name="method">execute</param>
			</result>			
		</action>

		<action name="addtracks"
			class="uk.co.unclealex.flacconverter.actions.AddTracksToCartAction">
			<result name="success" type="chain">
				<param name="actionName">tracks</param>
				<param name="namespace">/html</param>			
				<param name="method">execute</param>
			</result>
		</action>

		<action name="clearcart"
			class="uk.co.unclealex.flacconverter.actions.ClearCartAction">
			<result name="success" type="redirect">/html/index.html</result>
		</action>

		<action name="downloadcart"
			class="uk.co.unclealex.flacconverter.actions.FlacAction">
			<result name="success">/WEB-INF/pages/download-cart.jsp</result>
		</action>
	</package>
	
	<package name="ajax" namespace="/ajax" extends="default">

		<action name="devicedownload"
			class="uk.co.unclealex.flacconverter.actions.DeviceDownloadAction">
			<interceptor-ref name="defaultStack" />
			<interceptor-ref name="execAndWait" />
			<result name="success">/WEB-INF/ajax/device-finished.jsp</result>
			<result name="error">/WEB-INF/ajax/device-errored.jsp</result>
			<result name="wait">/WEB-INF/ajax/device-progress.jsp</result>			
			<result name="alreadywriting">/WEB-INF/ajax/device-used.jsp</result>
		</action>
		
		<action name="removeartist"
			class="uk.co.unclealex.flacconverter.actions.RemoveArtistFromCartAction">
			<result name="success">/WEB-INF/ajax/cart.jsp</result>
		</action>

		<action name="removealbum"
			class="uk.co.unclealex.flacconverter.actions.RemoveAlbumFromCartAction">
			<result name="success">/WEB-INF/ajax/cart.jsp</result>
		</action>

		<action name="removetrack"
			class="uk.co.unclealex.flacconverter.actions.RemoveTrackFromCartAction">
			<result name="success">/WEB-INF/ajax/cart.jsp</result>
		</action>

		<action name="clearcart"
			class="uk.co.unclealex.flacconverter.actions.ClearCartAction">
			<result name="success">/WEB-INF/ajax/cart.jsp</result>
		</action>
	</package>
</struts>