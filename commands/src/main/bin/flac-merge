#!/bin/bash
#
# Get the canonical path of a file or directory.
# When the file or directory itself is a link then this is not resolved.
#
# Note: the '&> /dev/null' is needed because the 'cd' command will also
# print the directory into which it changes when the CDPATH environment
# variable is set.
#
# 1: the file or directory
#
function path-canonical-simple() {
  local dst="${1}"
  cd -P -- "$(dirname -- "${dst}")" &> /dev/null && echo "$(pwd -P)/$(basename -- "${dst}")"
}


#
# Get the canonical path of a file or directory.
# When the file or directory itself is a link then this is also resolved.
#
# 1: the file or directory
#
function path-canonical() {
local dst="$(path-canonical-simple "${1}")"

while [[ -h "${dst}" ]]; do
local linkDst="$(ls -l "${dst}" | sed -r -e 's/^.*[[:space:]]*->[[:space:]]*(.*)[[:space:]]*$/\1/g')"
if [[ -z "$(echo "${linkDst}" | grep -E '^/')" ]]; then
# relative link destination
linkDst="$(dirname "${dst}")/${linkDst}"
fi
dst="$(path-canonical-simple "${linkDst}")"
done
echo "${dst}"
} 

BASEDIR=$(dirname "$(path-canonical "$0")")

echo $BASEDIR

CLASSPATH=$BASEDIR/../classes
for JAR in $BASEDIR/../lib/*.jar
do
  CLASSPATH=$CLASSPATH:$JAR
done
java -Djava.util.logging.config.file=$BASEDIR/../conf/logging.properties -cp $CLASSPATH uk.co.unclealex.music.command.MergeCommand merge.sh "$@"
